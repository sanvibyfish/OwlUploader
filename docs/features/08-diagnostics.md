# 08. ç³»ç»Ÿè¯Šæ–­ (Diagnostics)

## åŠŸèƒ½æ¦‚è¿°

ç³»ç»Ÿè¯Šæ–­æ¨¡å—æä¾›è¿æ¥é—®é¢˜æ’æŸ¥å’Œä¸Šä¼ åŠŸèƒ½è¯Šæ–­ï¼Œå¸®åŠ©ç”¨æˆ·è¯†åˆ«å’Œè§£å†³å¸¸è§é—®é¢˜ã€‚

## æ ¸å¿ƒç»„ä»¶

| æ–‡ä»¶ | èŒè´£ |
|------|-----|
| `DiagnosticsView.swift` | è¯Šæ–­ç•Œé¢ UI |
| `R2Service.swift` | è¯Šæ–­é€»è¾‘å®ç° |

## åŠŸèƒ½ç‰¹æ€§

### âœ… å·²å®ç°

- **ä¸Šä¼ å‰ç½®æ£€æŸ¥**: éªŒè¯ä¸Šä¼ åŠŸèƒ½æ‰€éœ€æ¡ä»¶
- **é—®é¢˜è¯†åˆ«**: è‡ªåŠ¨è¯†åˆ«å¸¸è§é…ç½®é—®é¢˜
- **å»ºè®®æ–¹æ¡ˆ**: æä¾›é’ˆå¯¹æ€§çš„è§£å†³å»ºè®®
- **å®æ—¶è¯Šæ–­**: ä¸€é”®è¿è¡Œå®Œæ•´è¯Šæ–­

## è¯Šæ–­é¡¹ç›®

### æ£€æŸ¥æ¸…å•

| æ£€æŸ¥é¡¹ | æè¿° |
|-------|-----|
| R2 è¿æ¥çŠ¶æ€ | æ˜¯å¦å·²æˆåŠŸè¿æ¥åˆ° R2 æœåŠ¡ |
| å­˜å‚¨æ¡¶é€‰æ‹© | æ˜¯å¦å·²é€‰æ‹©ç›®æ ‡å­˜å‚¨æ¡¶ |
| ç½‘ç»œè¿é€šæ€§ | æ˜¯å¦èƒ½è®¿é—® R2 ç«¯ç‚¹ |
| å‡­è¯æœ‰æ•ˆæ€§ | API å‡­è¯æ˜¯å¦æœ‰æ•ˆ |
| æƒé™æ£€æŸ¥ | æ˜¯å¦æœ‰ä¸Šä¼ /è¯»å–æƒé™ |

## ç”¨æˆ·ç•Œé¢

### è¯Šæ–­ç»“æœç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸ›¡ï¸ ç³»ç»Ÿè¯Šæ–­                â”‚
â”‚                                         â”‚
â”‚  æ£€æŸ¥ä¸Šä¼ åŠŸèƒ½çš„å‰ç½®æ¡ä»¶å’Œæä¾›æ•…éšœæ’é™¤å»ºè®®   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  âš ï¸ å‘ç°é—®é¢˜éœ€è¦è§£å†³                     â”‚
â”‚                                         â”‚
â”‚  å‘ç°çš„é—®é¢˜ï¼š                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â€¢ R2 æœåŠ¡æœªè¿æ¥                   â”‚   â”‚
â”‚  â”‚ â€¢ æœªé€‰æ‹©å­˜å‚¨æ¡¶                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  è§£å†³å»ºè®®ï¼š                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. è¯·å‰å¾€è´¦æˆ·è®¾ç½®é…ç½® R2 å‡­è¯      â”‚   â”‚
â”‚  â”‚ 2. è¿æ¥æˆåŠŸåé€‰æ‹©ç›®æ ‡å­˜å‚¨æ¡¶        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           [å…³é—­]    [å¼€å§‹è¯Šæ–­]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## è¯Šæ–­æµç¨‹

```mermaid
flowchart TD
    A[ç‚¹å‡»å¼€å§‹è¯Šæ–­] --> B[æ˜¾ç¤ºåŠ è½½çŠ¶æ€]
    B --> C[æ£€æŸ¥ R2 è¿æ¥]
    C --> D[æ£€æŸ¥å­˜å‚¨æ¡¶é€‰æ‹©]
    D --> E[æ£€æŸ¥ç½‘ç»œè¿é€šæ€§]
    E --> F[ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š]
    F --> G{æ‰€æœ‰æ£€æŸ¥é€šè¿‡?}
    G -->|æ˜¯| H[æ˜¾ç¤ºæˆåŠŸçŠ¶æ€]
    G -->|å¦| I[æ˜¾ç¤ºé—®é¢˜å’Œå»ºè®®]
```

## API æ–¹æ³•

### è¯Šæ–­ä¸Šä¼ é—®é¢˜

```swift
func diagnoseUploadIssues() -> (
    isReady: Bool, 
    issues: [String], 
    suggestions: [String]
)
```

### ç½‘ç»œè¯Šæ–­

```swift
private func performNetworkDiagnostics() async
```

## é”™è¯¯ç±»å‹ä¸å»ºè®®

### è¿æ¥é”™è¯¯

| é”™è¯¯ç±»å‹ | æè¿° | å»ºè®® |
|---------|-----|------|
| `connectionTimeout` | è¿æ¥è¶…æ—¶ | æ£€æŸ¥ç½‘ç»œè¿æ¥ |
| `dnsResolutionFailed` | DNS è§£æå¤±è´¥ | éªŒè¯ç«¯ç‚¹ URL |
| `sslCertificateError` | SSL è¯ä¹¦é”™è¯¯ | ç¡®è®¤ä½¿ç”¨ HTTPS |
| `endpointNotReachable` | ç«¯ç‚¹ä¸å¯è¾¾ | æ£€æŸ¥ URL æ ¼å¼ |

### è®¤è¯é”™è¯¯

| é”™è¯¯ç±»å‹ | æè¿° | å»ºè®® |
|---------|-----|------|
| `invalidCredentials` | å‡­è¯æ— æ•ˆ | é‡æ–°è¾“å…¥å‡­è¯ |
| `authenticationError` | è®¤è¯å¤±è´¥ | éªŒè¯ Access Key |
| `accountNotConfigured` | è´¦æˆ·æœªé…ç½® | å‰å¾€è´¦æˆ·è®¾ç½® |

## æˆåŠŸçŠ¶æ€

å½“æ‰€æœ‰æ£€æŸ¥é€šè¿‡æ—¶æ˜¾ç¤ºï¼š

```
âœ… ä¸Šä¼ åŠŸèƒ½å°±ç»ª

æ‰€æœ‰æ£€æŸ¥é¡¹ç›®å‡é€šè¿‡ï¼š
â€¢ R2 æœåŠ¡è¿æ¥æ­£å¸¸
â€¢ å­˜å‚¨æ¡¶å·²é€‰æ‹©
â€¢ ç½‘ç»œè¿æ¥æ­£å¸¸
â€¢ å…·æœ‰ä¸Šä¼ æƒé™

ç°åœ¨å¯ä»¥æ­£å¸¸ä¸Šä¼ æ–‡ä»¶ã€‚
```

## ç›¸å…³é“¾æ¥

- [è´¦æˆ·é…ç½®](./01-account-configuration.md)
- [å®‰å…¨å­˜å‚¨](./07-security-keychain.md)
