# 04. æ–‡ä»¶ä¸Šä¼  (File Upload)

## åŠŸèƒ½æ¦‚è¿°

æ–‡ä»¶ä¸Šä¼ æ¨¡å—æ”¯æŒä¸¤ç§æ–¹å¼å°†æœ¬åœ°æ–‡ä»¶ä¸Šä¼ åˆ° R2 å­˜å‚¨ï¼šæ–‡ä»¶é€‰æ‹©å™¨å’Œæ‹–æ‹½ä¸Šä¼ ã€‚ä¸Šä¼ çš„æ–‡ä»¶ä¼šä¿å­˜åˆ°å½“å‰æµè§ˆçš„ç›®å½•è·¯å¾„ä¸‹ã€‚

## æ ¸å¿ƒç»„ä»¶

| æ–‡ä»¶ | èŒè´£ |
|------|-----|
| `FileListView.swift` | ä¸Šä¼ æŒ‰é’®ä¸æ–‡ä»¶é€‰æ‹©å™¨ |
| `FileDropView.swift` | æ‹–æ‹½ä¸Šä¼  NSView ç»„ä»¶ |
| `R2Service.swift` | æ–‡ä»¶ä¸Šä¼  API |

## åŠŸèƒ½ç‰¹æ€§

### âœ… å·²å®ç°

- **æ–‡ä»¶é€‰æ‹©å™¨ä¸Šä¼ **: é€šè¿‡ç³»ç»Ÿæ–‡ä»¶å¯¹è¯æ¡†é€‰æ‹©æ–‡ä»¶
- **æ‹–æ‹½ä¸Šä¼ **: å°†æ–‡ä»¶æ‹–å…¥åˆ—è¡¨åŒºåŸŸè‡ªåŠ¨ä¸Šä¼ 
- **ä¸Šä¼ çŠ¶æ€æ˜¾ç¤º**: æ˜¾ç¤ºä¸Šä¼ è¿›åº¦å’ŒçŠ¶æ€
- **è‡ªåŠ¨åˆ·æ–°**: ä¸Šä¼ å®Œæˆåè‡ªåŠ¨åˆ·æ–°æ–‡ä»¶åˆ—è¡¨
- **é”™è¯¯å¤„ç†**: ä¸Šä¼ å¤±è´¥æ—¶æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯

### ğŸ“‹ ä¸Šä¼ é™åˆ¶

| é™åˆ¶é¡¹ | å€¼ | è¯´æ˜ |
|-------|-----|------|
| æœ€å¤§æ–‡ä»¶å¤§å° | 5 GB | è¶…è¿‡é™åˆ¶æ—¶æç¤ºé”™è¯¯ |
| å•æ¬¡ä¸Šä¼ æ•°é‡ | 1 ä¸ª | æš‚ä¸æ”¯æŒæ‰¹é‡ä¸Šä¼  |
| æ–‡ä»¶åé™åˆ¶ | S3 è§„èŒƒ | ä¸å…è®¸ç‰¹æ®Šå­—ç¬¦ |

## ä¸Šä¼ æ–¹å¼

### æ–¹å¼ä¸€ï¼šæ–‡ä»¶é€‰æ‹©å™¨

1. ç‚¹å‡»å·¥å…·æ çš„ **"ä¸Šä¼ æ–‡ä»¶"** æŒ‰é’®
2. åœ¨ç³»ç»Ÿå¯¹è¯æ¡†ä¸­é€‰æ‹©æ–‡ä»¶
3. ç¡®è®¤åå¼€å§‹ä¸Šä¼ 
4. ä¸Šä¼ å®Œæˆåè‡ªåŠ¨åˆ·æ–°åˆ—è¡¨

### æ–¹å¼äºŒï¼šæ‹–æ‹½ä¸Šä¼ 

1. å°†æ–‡ä»¶ä» Finder æ‹–å…¥æ–‡ä»¶åˆ—è¡¨åŒºåŸŸ
2. æ¾å¼€é¼ æ ‡å¼€å§‹ä¸Šä¼ 
3. ä¸Šä¼ å®Œæˆåè‡ªåŠ¨åˆ·æ–°åˆ—è¡¨

## äº¤äº’æµç¨‹

```mermaid
flowchart TD
    A[ç”¨æˆ·é€‰æ‹©æ–‡ä»¶] --> B{æ–‡ä»¶éªŒè¯}
    B -->|å¤§å°è¶…é™| C[æ˜¾ç¤ºé”™è¯¯æç¤º]
    B -->|æ–‡ä»¶åæ— æ•ˆ| C
    B -->|éªŒè¯é€šè¿‡| D[å¼€å§‹ä¸Šä¼ ]
    D --> E[æ˜¾ç¤ºä¸Šä¼ çŠ¶æ€]
    E --> F{ä¸Šä¼ ç»“æœ}
    F -->|æˆåŠŸ| G[åˆ·æ–°æ–‡ä»¶åˆ—è¡¨]
    F -->|å¤±è´¥| H[æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯]
    G --> I[æ˜¾ç¤ºæˆåŠŸæç¤º]
```

## æ–‡ä»¶éªŒè¯è§„åˆ™

### æ–‡ä»¶åéªŒè¯
```swift
func isValidFileName(_ fileName: String) -> Bool {
    // éç©ºæ£€æŸ¥
    // ç¦æ­¢ç‰¹æ®Šå­—ç¬¦: < > : " | ? *
    // ç¦æ­¢ Windows ä¿ç•™å: CON, PRN, AUX, NUL, COM1-9, LPT1-9
}
```

### æ–‡ä»¶å¤§å°éªŒè¯
```swift
let maxFileSize = 5 * 1024 * 1024 * 1024  // 5GB
```

## API æ–¹æ³•

### ä¸Šä¼ æ–‡ä»¶
```swift
func uploadFile(
    localURL: URL, 
    remotePath: String, 
    originalFileName: String
) async throws
```

## æ‹–æ‹½ä¸Šä¼ ç»„ä»¶

`FileDropView` åŸºäº `NSViewRepresentable` å®ç°ï¼Œå°è£…äº† macOS åŸç”Ÿæ‹–æ‹½åŠŸèƒ½ï¼š

```swift
struct FileDropView: NSViewRepresentable {
    var onFileDrop: ((URL, String) -> Void)?
    var onError: ((String, String) -> Void)?
    var isEnabled: Bool
}
```

## é”™è¯¯ç±»å‹

| é”™è¯¯ | æè¿° |
|------|-----|
| `uploadFailed` | ä¸Šä¼ è¯·æ±‚å¤±è´¥ |
| `invalidFileSize` | æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ |
| `fileAccessDenied` | æ— æ³•è¯»å–æ–‡ä»¶ |
| `networkError` | ç½‘ç»œè¿æ¥é”™è¯¯ |

## ç›¸å…³é“¾æ¥

- [æ–‡ä»¶å¯¼èˆª](./03-file-navigation.md)
- [æ–‡ä»¶ä¸‹è½½ä¸åˆ é™¤](./05-file-download-delete.md)
