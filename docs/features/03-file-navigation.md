# 03. 文件导航 (File Navigation)

## 功能概述

文件导航模块提供存储桶内文件和文件夹的浏览功能，采用 **Finder 风格** 界面设计，支持多种视图模式、路径导航和高级选择操作。

> **设计规范**: 详细的 UI 规范请参阅 [09. Finder UI 设计规范](./09-finder-ui-design.md)

## 核心组件

| 文件 | 职责 |
|------|-----|
| `FileListView.swift` | 文件列表主界面 |
| `FileGridView.swift` | 图标网格视图 |
| `FileGridItemView.swift` | 网格项组件（支持缩略图） |
| `FileTableView.swift` | 表格视图（可排序列头） |
| `FinderToolbar.swift` | Finder 风格工具栏 |
| `PathBar.swift` | 路径导航栏 |
| `NavigationHistoryManager.swift` | 导航历史管理（前进/后退） |
| `FileObject.swift` | 文件对象数据模型 |

## 功能特性

### ✅ 已实现

- **多视图模式**: 表格 / 图标网格 (`Cmd+1/2` 切换)
- **图片缩略图**: 图标视图下显示图片缩略图预览
- **Finder 风格选择**: 单选 / `Cmd+点击` 多选 / `Shift+点击` 范围选择
- **文件夹导航**: 单击进入文件夹
- **导航历史**: 前进/后退导航 (`Cmd+[` / `Cmd+]`)
- **路径导航栏**: 面包屑风格，点击跳转任意层级
- **文件预览**: 双击文件打开预览窗口
- **搜索过滤**: 实时搜索 + 类型筛选
- **排序功能**: 支持点击表格列头排序（名称 / 大小 / 修改日期 / 类型）
- **刷新功能**: 重新加载当前目录内容
- **空状态提示**: 当文件夹为空时显示提示
- **加载状态**: 加载中显示进度指示器

### 📱 界面布局

```
┌───────────────────────────────────────────────────────────────┐
│ [← ↑] [↻]  │   [🔍 搜索...]   │ [📁+] [↑] [筛选] [排序] [视图] │  <- FinderToolbar
├───────────────────────────────────────────────────────────────┤
│ 🪣 my-bucket  >  📁 documents  >  📁 images                   │  <- PathBar
├───────────────────────────────────────────────────────────────┤
│ ┌─────┐  ┌─────┐  ┌─────┐  ┌─────┐  ┌─────┐                  │
│ │ 📁  │  │ 🖼️  │  │ 🖼️  │  │ 📄  │  │ 📦  │    <- 图标视图   │
│ │folder│  │photo1│  │photo2│  │ doc │  │ zip │                │
│ └─────┘  └─────┘  └─────┘  └─────┘  └─────┘                  │
└───────────────────────────────────────────────────────────────┘
```

## 导航操作

| 操作 | 触发方式 | 说明 |
|------|---------|------|
| 进入文件夹 | 单击文件夹 | 导航到子目录 |
| 预览文件 | 双击文件 | 打开预览窗口（支持图片、视频、音频、PDF、文本） |
| 后退 | 点击工具栏 `◀` 或 `Cmd+[` | 返回上一个访问的目录 |
| 前进 | 点击工具栏 `▶` 或 `Cmd+]` | 前往下一个目录（后退后可用） |
| 返回上级 | 点击工具栏 `↑` 或 `Cmd+↑` | 回到父目录 |
| 快速跳转 | 点击路径栏任意层级 | 跳转到指定目录 |
| 刷新 | 点击工具栏 `↻` 或 `Cmd+R` | 重新加载列表 |

## 文件类型图标

| 类型 | 图标 | 扩展名 |
|------|:----:|--------|
| 文件夹 | 📁 | - |
| 图片 | 🖼️ | jpg, png, gif, webp, svg |
| 视频 | 🎬 | mp4, mov, avi, mkv |
| 音频 | 🎵 | mp3, wav, flac, aac |
| 文档 | 📄 | pdf, doc, docx, txt |
| 代码 | 💻 | js, ts, py, swift |
| 压缩 | 📦 | zip, rar, 7z, tar |
| 其他 | 📎 | * |

## API 方法

### 列出目录内容
```swift
func listFiles(prefix: String) async throws -> [FileObject]
```

### 刷新文件列表
```swift
func refreshFileList() async
```

## 数据模型

```swift
struct FileObject: Identifiable, Hashable {
    let id: UUID
    let key: String           // 完整路径
    let name: String          // 显示名称
    let size: Int64?          // 文件大小 (bytes)
    let lastModified: Date?   // 最后修改时间
    let isFolder: Bool        // 是否为文件夹
    let etag: String?         // ETag 标识
}
```

## 排序功能

### 表格视图排序

表格视图支持点击列头进行排序，提供多列排序选项：

| 排序字段 | 说明 | 交互方式 |
|---------|------|---------|
| **名称** | 按文件名字母顺序排序 | 点击"名称"列头 |
| **修改日期** | 按最后修改时间排序 | 点击"修改日期"列头 |
| **大小** | 按文件大小排序 | 点击"大小"列头 |
| **类型** | 按文件类型排序（文件夹/扩展名） | 点击"类型"列头 |

**排序方向**:
- 首次点击列头：升序排序
- 再次点击同一列头：降序排序
- 点击不同列头：切换排序字段（保持升序）

**实现细节**:
- 使用计算型 Binding 模式实现状态同步
- 排序逻辑经过 18 个单元测试验证
- 详细技术说明参见 [09. Finder UI 设计规范 - 表格视图排序](./09-finder-ui-design.md#12-表格视图排序-table-column-sorting)

## 相关链接

- [02. 存储桶操作](./02-bucket-operations.md)
- [04. 文件上传](./04-file-upload.md)
- [06. 文件夹管理](./06-folder-management.md)
- [09. Finder UI 设计规范](./09-finder-ui-design.md) - 详细的 UI 组件和交互规范
